---
permalink: sm-mirroring/how-synchronous-mirroring-works.html 
sidebar: sidebar 
keywords: SANtricity, System Manager, E-Series, synchronous, mirroring, 
summary: 同期ミラーリングでは、データボリュームをリアルタイムでレプリケートして、継続的な可用性を確保します。 
---
= 同期ミラーリングの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
同期ミラーリングでは、データボリュームをリアルタイムでレプリケートして、継続的な可用性を確保します。

[NOTE]
====
EF600またはEF300ストレージアレイではミラーリングを使用できません。

====
同期ミラーリングでは、2つのストレージアレイのいずれかで災害が発生した場合に重要なデータのコピーを確保しておくことにより、データ損失ゼロの目標復旧時点（RPO）を達成します。プライマリボリュームに書き込みが行われるたびにセカンダリボリュームにも書き込みが行われるため、どの時点においてもコピーは本番環境のデータと同一です。プライマリボリュームで行われた変更でセカンダリボリュームが更新されるまで、ホストは書き込みが成功したという確認応答を受信しません。

このタイプのミラーリングは、ディザスタリカバリなどのビジネス継続性の確保に最適です。



== 同期ミラー関係

同期ミラー関係は、別々のストレージアレイ上のプライマリボリュームとセカンダリボリュームで構成されます。プライマリボリュームを含むストレージアレイは、通常はプライマリサイトにあり、アクティブなホストに対応します。セカンダリボリュームを含むストレージアレイは、通常はセカンダリサイトにあり、データのレプリカを格納します。セカンダリボリュームは、プライマリサイトで完全な停電、火災、ハードウェア障害が発生した場合など、プライマリボリュームのストレージアレイが使用できなくなった場合に使用されます。



== 同期ミラーリングセッション

同期ミラーリングの構成プロセスには、ボリュームをペアとして構成することが含まれます。一方のストレージアレイのプライマリボリュームともう一方のストレージアレイのセカンダリボリュームで構成されるミラーペアを作成したら、同期ミラーリングを開始できます。同期ミラーリングは以下のように実行されます。

image::../media/sam-1130-dwg-sync-mirroring-session.gif[SAM 1130 DWG同期ミラーリングセッション]

. ホストから書き込みが行われます。
. 書き込みはプライマリボリュームにコミットされ、リモートシステムに伝播され、セカンダリボリュームにコミットされます。
. プライマリボリュームのストレージアレイからホストsystem_after_both書き込み処理が完了したときに、I/O完了メッセージが送信されます。


リザーブ容量は、ホストからの書き込み要求に関する情報の記録に使用されます。

プライマリボリュームの現在のコントローラ所有者がホストからの書き込み要求を受け取ると、コントローラはまず書き込みに関する情報をプライマリボリュームのリザーブ容量に記録します。次に、プライマリボリュームにデータを書き込みます。次に、コントローラがリモート書き込み処理を開始し、影響を受けたデータブロックをリモートストレージアレイのセカンダリボリュームにコピーします。

ホストアプリケーションは、ローカルストレージアレイおよびリモートストレージアレイ上のネットワークで書き込みが行われるまで待機する必要があるため、 ローカルのI/Oパフォーマンスを大幅に低下させることなくミラー関係を維持するには、ローカルストレージアレイとリモートストレージアレイの間に非常に高速な接続が必要です。



== ディザスタリカバリ

同期ミラーリングでは、データが存在するサイトから物理的に離れた場所にデータのコピーが保持されます。停電や洪水などの災害がプライマリサイトで発生した場合、すぐにセカンダリサイトからデータにアクセスできます。

同期ミラーリング処理の進行中は、ホストアプリケーションはセカンダリボリュームを使用できないため、ローカルストレージアレイで災害が発生した場合はリモートストレージアレイにフェイルオーバーできます。フェイルオーバーするには、セカンダリボリュームをプライマリロールに昇格します。これで、新しく昇格されたボリュームにリカバリホストがアクセスできるようになり、業務を続行できます。



== 同期の設定

ミラーペアを作成するときは、同期優先度と再同期ポリシーも定義します。通信が中断した場合、ミラーペアはこれらを使用して再同期処理を完了します。

2つのストレージアレイ間の通信リンクが停止しても、ホストはローカルストレージアレイからの確認応答を引き続き受信し、アクセスが失われるのを防ぎます。通信リンクの動作が再開したら、レプリケートされていないデータを自動的に、または手動で、リモートストレージアレイに再同期できます。

データが自動的に再同期されるかどうかは、ミラーペアの再同期ポリシーによって異なります。自動再同期ポリシーを使用すると、リンクの再同期が完了した時点でミラーペアが自動的に再同期されます。手動再同期ポリシーを使用している場合は、通信問題の発生後に同期を手動で再開する必要があります。手動再同期ポリシーが推奨されるポリシーです。

ミラーペアの同期設定は、プライマリボリュームを含むストレージアレイでのみ編集できます。



== 同期されていないデータ

プライマリボリュームのストレージアレイがセカンダリボリュームにデータを書き込むことができなくなった場合、プライマリボリュームとセカンダリボリュームは非同期状態になります。これは、次の問題が原因で発生する可能性があります。

* ローカルストレージアレイとリモートストレージアレイ間のネットワーク問題
* セカンダリボリュームの障害
* ミラーペアの同期が手動で一時停止されている




== 孤立したミラーペア

孤立したミラーペアボリュームは、一方（プライマリまたはセカンダリ）でメンバーボリュームが削除され、もう一方では削除されていない場合に発生します。

孤立したミラーペアボリュームは、アレイ間の通信がリストアされ、ミラー構成の両サイドでミラーパラメータが調整されたときに検出されます。

ミラーペアを削除すると、孤立したミラーペアの状態を修正できます。



== 設定と管理

2つのアレイ間のミラーリングを有効にして設定するには、Unified Managerインターフェイスを使用する必要があります。ミラーリングを有効にすると、System Managerでミラーペアと同期設定を管理できます。
